<!DOCTYPE html>
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
   <meta name="language" content="zh_cn" />
   <title>比价图</title>
	<!-- 新 Bootstrap 核心 CSS 文件 -->
    <!-- <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap.min.css"> -->
	<link rel="stylesheet" type="text/css" href="http://bebraw.github.io/Chart.js.legend/css/demo.css"><!-- ../../../static/css/chart.css -->
    <script src="../../../static/chartjs/Chart.js"></script>
    <script>
    	function legend(parent, data) {
	    parent.className = 'legend';
	    //parent.style.border = '1px solid black';
	    var datas = data.hasOwnProperty('datasets') ? data.datasets : data;

	    // remove possible children of the parent
	    while(parent.hasChildNodes()) {
	        parent.removeChild(parent.lastChild);
	    }

	    datas.forEach(function(d) {
	        var title = document.createElement('span');
	        title.className = 'title';
	        title.style.borderColor = d.hasOwnProperty('strokeColor') ? d.strokeColor : d.color;
	        title.style.borderStyle = 'solid';
	        parent.appendChild(title);

	        var anode = document.createElement('a');
	        anode.setAttribute('href', d.prodlink);
	        var text = document.createTextNode(d.label);
	        anode.appendChild(text);
	        title.appendChild(anode);
	    });
	}
    </script>
</head>
<body>
	{% if brand_passed %}
	<h1>{{ brand }}</h1>
	{% endif %}
	<div>
		<ul>
		{% for key,value in series_list %}
		    <li>
		    	<h2>{{ key }}</h2>
		    	{% for seg in value %}
		    		<h3>{{ seg }}段</h3>
						<div style="border: 1px solid blue; margin: 10px;">
							<canvas id="canvas-{{ key }}-{{ seg }}" height="150" width="200"></canvas>
						</div>
						<div id="legend-{{ key }}-{{ seg }}"></div>
				{% endfor %}	    	
		    </li>
		{% endfor %}
		</ul>
	</div>

<!-- jQuery文件。务必在bootstrap.min.js 之前引入
<script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
<!-- 最新的 Bootstrap 核心 JavaScript 文件
<script src="http://cdn.bootcss.com/bootstrap/3.2.0/js/bootstrap.min.js"></script> -->

<script>
{% for chartid, chartdata in chartdata_list %}
	var {{ chartid }} = {{ chartdata|safe }};
{% endfor %}

window.onload = function(){
{% for chartid, realchartid in realchartIds %}
	var ctx_{{ chartid }} = document.getElementById("canvas-{{ realchartid }}").getContext("2d"); //<!-- chartid =  {{ series }}-{{ seg }}-->
	var chart_{{ chartid }} = new Chart(ctx_{{ chartid }}).Line( {{ chartid }}, {	animation: false, responsive: true, bezierCurve: false});
	//var legend_{{ chartid }} = chart_{{ chartid }}.generateLegend();
	//$("#legend-{{ realchartid }}").html(legend_{{ chartid }});
	legend(document.getElementById("legend-{{ realchartid }}"), {{ chartid }});
{% endfor %}
}
</script>
</body>
</html>